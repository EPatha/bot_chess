<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EP Chess Bot</title>
  <link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      background: #f7f7f7; /* terang */
      color: #111;
      margin: 0;
    }
    .board-wrap { display: grid; grid-template-columns: 28px 384px; gap: 8px; align-items: center; }
    #board {
      width: 384px;
      height: 384px;
      display: grid;
      grid-template-columns: repeat(8,48px);
      grid-template-rows: repeat(8,48px);
      gap: 0;
      border: 2px solid #333;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      background: #fff;
    }
    #ranks { display: grid; grid-template-rows: repeat(8,48px); height: 384px; }
    #ranks .rank { display:flex; align-items:center; justify-content:center; color:#333; font-weight:600; }
    #files { display:flex; width:384px; justify-content:space-between; margin-top:6px; padding:0 4px; color:#333; font-weight:600; }
    #board .message { padding: 12px; font-weight: 600; }
    .square { width:48px; height:48px; display:flex; align-items:center; justify-content:center; font-size:28px; position:relative; }
    .light { background:#f0d9b5; }
    .dark { background:#b58863; }
    .square .coord { position:absolute; font-size:10px; color: rgba(0,0,0,0.65); }
    .square .coord.file { right:4px; bottom:2px; }
    .square .coord.rank { left:4px; top:2px; }
    /* piece styling: render pieces without a circular background.
       For white pieces we use white fill for the glyph and add a dark outline
       using multiple text-shadow layers so the white stays inside the piece shape. */
    .piece { display:inline-flex; align-items:center; justify-content:center; line-height:1; padding:0 2px; }
    .piece.white {
      background: transparent;
      border: none;
      color: #ffffff; /* white fill */
      font-size:26px;
      /* outline for white pieces: 4-directional shadow to approximate a stroke */
      text-shadow:
        -1px -1px 0 #111,
        1px -1px 0 #111,
        -1px 1px 0 #111,
        1px 1px 0 #111;
    }
    .piece.black { background: transparent; color: #111; font-size:26px; }
    #controls { margin-top: 12px; display:flex; gap:8px; align-items:center; }
    button { padding:8px 12px; }
    #log { margin-top:12px; max-width:700px; white-space:pre-wrap; font-family:monospace; }
  </style>
  <script>
    // error reporting helper: tampilkan error di halaman supaya user tidak hanya melihat kotak kosong
    function reportErrorToPage(msg) {
      try {
        console.error(msg);
        const boardEl = document.getElementById('board');
        const safe = String(msg).replace(/</g, '&lt;').replace(/\n/g,'<br>');
        if (boardEl) boardEl.innerHTML = '<div class="message" style="color:#900;background:#fff;padding:12px;">' + safe + '</div>';
        else document.body.insertAdjacentHTML('afterbegin','<div class="message" style="color:#900;background:#fff;padding:12px;">'+safe+'</div>');
      } catch (e) {
        console.error('Failed to render error to page', e);
      }
    }

    window.addEventListener('error', function (e) {
      reportErrorToPage('Error: ' + (e && e.message ? e.message : e));
    });
    window.addEventListener('unhandledrejection', function (e) {
      const reason = e && e.reason ? (e.reason.message || e.reason) : e;
      reportErrorToPage('Unhandled promise rejection: ' + reason);
    });
  </script>
</head>
<body>
  <div class="board-wrap">
    <div id="ranks"></div>
    <div id="board"><div class="message">Memuat papan...</div></div>
  </div>

  <div id="files" aria-hidden="true"></div>

  <div id="controls">
    <button id="btn-next">Next Move (bot)</button>
    <button id="btn-reset">Reset</button>
    <label><input type="checkbox" id="auto"> Auto-play (1s)</label>
  </div>

  <div id="info">
    <strong>FEN:</strong> <span id="fen"></span>
  </div>
  <div id="log"></div>

  <!-- Load chess.js (UMD) so ui.js can use the global Chess constructor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <!-- Use the simple ui module that renders board as Unicode pieces -->
  <script type="module" src="./ui.js"></script>
</body>
</html>
